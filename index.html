<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>毕业生追踪系统</title>
    <!-- 内联关键CSS确保页面基础渲染 -->
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "Microsoft YaHei", sans-serif; padding: 20px; }
        .page { display: none; max-width: 800px; margin: 0 auto; }
        .page.active { display: block; }
        .nav-btn { margin: 5px; padding: 8px 16px; cursor: pointer; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 8px; margin-bottom: 5px; }
        .error { color: #dc3545; font-size: 0.9em; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 10px 20px; background: #333; color: white; border-radius: 4px; display: none; }
        .toast.show { display: block; }
        #submit-register { margin-top: 10px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <!-- 导航按钮 -->
    <div class="nav">
        <button class="nav-btn" onclick="showPage('home-page')">首页</button>
        <button class="nav-btn" onclick="showPage('register-page')">注册信息</button>
        <button class="nav-btn" onclick="showPage('search-page')">查询信息</button>
    </div>

    <!-- 首页 -->
    <div id="home-page" class="page active">
        <h2>毕业生追踪系统</h2>
        <p>请使用导航按钮选择操作</p>
    </div>

    <!-- 注册页面 -->
    <div id="register-page" class="page">
        <h2>注册毕业生信息</h2>
        <form id="register-form">
            <div class="form-group">
                <label for="name">姓名 *</label>
                <input type="text" id="name" required>
                <div class="error" id="name-error"></div>
            </div>

            <div class="form-group">
                <label for="highschool">毕业学校 *</label>
                <input type="text" id="highschool" required>
                <div class="error" id="school-error"></div>
            </div>

            <div class="form-group">
                <label for="graduation-year">毕业年份 *</label>
                <input type="text" id="graduation-year" placeholder="如2023" required>
                <div class="error" id="year-error"></div>
            </div>

            <!-- 注册按钮 - 添加唯一ID确保事件绑定 -->
            <button type="button" id="submit-register">提交注册</button>
        </form>
    </div>

    <!-- 查询页面 -->
    <div id="search-page" class="page">
        <h2>查询毕业生信息</h2>
        <div class="form-group">
            <label for="search-name">姓名</label>
            <input type="text" id="search-name">
        </div>
        <button id="search-btn">查询</button>
        <div id="results"></div>
    </div>

    <!-- 提示框 -->
    <div class="toast" id="toast"></div>

    <!-- 脚本放在body底部确保DOM加载完成 -->
    <script>
        // 页面切换功能
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // 显示提示框
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // 页面加载完成后初始化事件绑定
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面DOM加载完成，初始化注册按钮事件');
            
            // 注册按钮点击事件
            const registerBtn = document.getElementById('submit-register');
            if (!registerBtn) {
                console.error('未找到注册按钮，请检查ID是否为"submit-register"');
                return;
            }

            registerBtn.addEventListener('click', async function() {
                console.log('注册按钮被点击');
                
                // 获取表单数据
                const name = document.getElementById('name').value.trim();
                const highschool = document.getElementById('highschool').value.trim();
                const graduationYear = document.getElementById('graduation-year').value.trim();
                
                // 重置错误提示
                document.querySelectorAll('.error').forEach(el => el.textContent = '');
                
                // 表单验证
                let isValid = true;
                if (!name) {
                    document.getElementById('name-error').textContent = '请输入姓名';
                    isValid = false;
                }
                if (!highschool) {
                    document.getElementById('school-error').textContent = '请输入毕业学校';
                    isValid = false;
                }
                if (!graduationYear) {
                    document.getElementById('year-error').textContent = '请输入毕业年份';
                    isValid = false;
                } else if (!/^\d{4}$/.test(graduationYear)) {
                    document.getElementById('year-error').textContent = '请输入4位数字的年份';
                    isValid = false;
                }

                if (!isValid) {
                    console.log('表单验证失败');
                    return;
                }

                // 提交数据
                try {
                    console.log('开始提交注册数据', { name, highschool, graduationYear });
                    const response = await fetch('/.netlify/functions/save-graduate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name,
                            highschool,
                            graduation_year: graduationYear
                        })
                    });

                    const result = await response.json();
                    if (response.ok && result.success) {
                        showToast('注册成功！');
                        console.log('注册成功', result);
                        document.getElementById('register-form').reset();
                    } else {
                        showToast(`注册失败: ${result.error || '未知错误'}`);
                        console.error('注册失败', result);
                    }
                } catch (error) {
                    showToast('网络错误，无法提交');
                    console.error('注册请求错误', error);
                }
            });

            // 查询按钮事件（保持原有功能）
            document.getElementById('search-btn').addEventListener('click', function() {
                // 原有查询逻辑
                showToast('查询功能待实现');
            });
        });
    </script>
</body>
</html>
    